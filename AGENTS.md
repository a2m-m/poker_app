# AGENTS.md

このリポジトリは「トランプ1組だけでテキサスホールデム（キャッシュゲーム）を回すための、タブレット1台 “パス＆プレイ” ディーラー支援アプリ」を実装する。
あなた（Codex/AIエージェント）は、実装・修正・リファクタリングの前に **必ず本ファイルを読む**。

---

## 0. 最重要（このリポジトリの鉄則）
- **MVPはキャッシュゲーム / サイドポット無し**
- カードは **物理**（アプリはカード状態を保持しない）
- チップは **アプリ上で管理**（スタック/ベット/ポット）
- 端末は **横持ち固定**、タブレットを回して使う
- UIは「状況が一目で分かる」「誤タップしにくい」「少タップ」を最優先
- GitHub Pagesで配布する（静的ホスティング）
- 仕様の曖昧さが出たら、**勝手に拡張せず**ドキュメントを更新する（下記「変更ルール」参照）

---

## 1. 参照すべきドキュメント（必読順）
作業前に最低限以下を読む。迷ったときは常にこれに戻る。

1. `01_product_brief.md`  
   - 目的、スコープ、非ゴール、前提ルール、受け入れ条件の北極星
2. `02_ux_principles.md`  
   - UX優先順位、情報の階層、初心者ガイドの方針
3. `03_ia_navigation.md`  
   - 画面（Route）と別レイヤー（モーダル/ドロワー）の分離
4. `04_wireframe_layout_spec.md`  
   - テーブル画面の固定レイアウト（TopBar / PlayerGrid / ActionPanel）
5. `05_ui_style_guide.md`  
   - UI規約（大きいボタン、状態表現、トークン）
6. `06_component_spec.md`  
   - コンポーネントの役割・入出力・状態・禁止事項
7. `07_user_flows.md`  
   - MVPのクリティカルシナリオ（新規→1ハンド完走→次ハンド等）
8. `08_domain_data_model.md`  
   - 状態/計算ルール（applyAction、availableActions、ラウンド終了判定）
9. `09_tech_spec_architecture.md`  
   - 技術選定、ディレクトリ、HashRouter、永続化、テスト方針
10. `10_implementation_plan.md`  
   - タスク分解（Issue向け）

---

## 2. 仕様の“固定点”（変更禁止に近いもの）
MVPでは以下を変えない。変える場合は必ずドキュメント更新が先。

- ゲーム種別：キャッシュゲーム
- 人数：2〜9人
- サイドポット：未対応（例外時は抑止/警告）
- 画面：`/` `/setup` `/table` の3ルートが基本
- テーブル画面：TopBar / PlayerGrid / ActionPanel の3レーン構成
- 役一覧・判定ツール：別レイヤー（モーダル/ドロワー）。常時表示しない
- ルーティング：GitHub Pages前提なので HashRouter を推奨
- 状態更新：UIから直接 stack/pot を触らず、Domainロジック（reducer/applyAction）経由

---

## 3. 実装の基本方針（DomainとUIの分離）
- `src/domain` にゲームロジックを集中させる（UIは計算しない）
- UIは `selectors` を通して表示に必要な値を得る
- `applyAction()` は純粋関数（可能な限り）で実装し、テストしやすくする
- Undoのために、アクション適用時に差分（history）を積む

---

## 4. サイドポット非対応の扱い（重要）
MVPはサイドポット非対応。以下の方針を守る。

- `stack < toCall` のようにオールインが絡みサイドポットが必要になる状況は、
  - 可能なら UI で抑止（CALL/RAISEを無効化）
  - それでも発生したら警告（例：「サイドポット未対応です。このハンドは手計算で処理してください。」）
- **負のスタック**や**矛盾したポット**を絶対に作らない

---

## 5. 不変条件（Invariant）チェック
実装中は常に `08_domain_data_model.md` の不変条件を守ること。
- stack >= 0
- betThisRound >= 0
- pot >= 0
- currentBet は最大投入額と整合
- Undo後も同様に整合

---

## 6. UI文言（ガイドのトーン）
- 長文説明はしない（1行ガイド）
- “次にやること”を提示する（例：「フロップを3枚めくってください」）
- 役一覧・判定ツールは「困ったら開く」導線

---

## 7. 作業の進め方（推奨）
1. `10_implementation_plan.md` の順に実装
2. 迷ったら `01/02/07/08` に戻る
3. 仕様変更が必要なら、まず該当ドキュメントを更新し、コミットに含める

---

## 8. 変更ルール（ドキュメントとコードの整合）
- 仕様を変えるPR/コミットは、**必ず先にドキュメント修正を含める**
- ドキュメントと実装が矛盾する場合は、原則ドキュメントが正
- 追加機能（例：トーナメント、サイドポット、統計など）はMVPの後（別ブランチ/別マイルストーン）

---

## 9. ビルド/実行/デプロイ（要点）
- ローカル：Viteで `npm run dev`
- Pages：HashRouter、GitHub Actionsで build→deploy（`09_tech_spec_architecture.md` 参照）

---

## 10. まず最初に通すべき“動作確認”
- 新規ゲーム作成 → テーブル開始（SB/BB徴収される）
- 1ハンド完走（Preflop→…→Showdown→勝者付与→次ハンド）
- Bet/Raise/Fold/All-fold終了
- Undo（直前1手）
- 役一覧が開ける（判定ツールは任意）

---

（このAGENTS.mdは、プロジェクトの進行に合わせて更新してよい。
ただし更新時は、必ず「何が変わったか」をPR/コミットメッセージに明記する。）
